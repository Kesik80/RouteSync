<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="theme-color" content="#0a0a0f"/>
<title>RouteSync ‚Äî Verlauf</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#0a0a0f;--bg2:#0f0f1a;--bg3:#141420;
  --surface:#1a1a2e;--surface2:#1e1e35;
  --border:rgba(255,255,255,0.07);--border2:rgba(255,255,255,0.12);
  --text:#f0f0f8;--text2:#9090b0;--text3:#5a5a7a;
  --accent:#6c63ff;--accent2:#a78bfa;
  --green:#10d97e;--orange:#ff7c3d;--red:#ff4d6d;--blue:#3d9eff;--yellow:#ffd60a;
  --font:'Space Grotesk',sans-serif;--mono:'DM Mono',monospace;
  --safe-top:env(safe-area-inset-top,0px);--safe-bot:env(safe-area-inset-bottom,0px);
}
html{-webkit-tap-highlight-color:transparent;}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100dvh;}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;
  background:radial-gradient(ellipse at 30% 0%,rgba(108,99,255,0.1),transparent 50%);
}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{
  position:sticky;top:0;z-index:50;
  padding:calc(var(--safe-top) + 12px) 16px 12px;
  background:rgba(10,10,15,0.85);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:12px;
}
.back-btn{
  width:36px;height:36px;border-radius:10px;
  background:var(--surface);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;color:var(--text2);text-decoration:none;
  font-size:18px;transition:all .2s;flex-shrink:0;
}
.back-btn:hover{background:var(--surface2);color:var(--text);}
.topbar-title{font-size:17px;font-weight:700;}
.topbar-sub{font-size:12px;color:var(--text3);margin-left:auto;}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
main{
  max-width:480px;margin:0 auto;
  padding:20px 16px calc(40px + var(--safe-bot));
}

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stats-grid{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;
  margin-bottom:24px;
}
.stat-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:16px;position:relative;overflow:hidden;
}
.stat-card::after{
  content:'';position:absolute;
  top:-20px;right:-20px;width:80px;height:80px;border-radius:50%;
  background:var(--accent-glow,rgba(108,99,255,0.08));
  pointer-events:none;
}
.stat-icon{font-size:20px;margin-bottom:8px;}
.stat-val{font:700 26px var(--mono);line-height:1;}
.stat-label{font-size:11px;color:var(--text3);margin-top:4px;font-weight:500;}

.stat-card.green{--accent-glow:rgba(16,217,126,0.1);}
.stat-card.green .stat-val{color:var(--green);}
.stat-card.orange{--accent-glow:rgba(255,124,61,0.1);}
.stat-card.orange .stat-val{color:var(--orange);}
.stat-card.blue{--accent-glow:rgba(61,158,255,0.1);}
.stat-card.blue .stat-val{color:var(--blue);}
.stat-card.purple .stat-val{color:var(--accent2);}

/* ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ */
.filter-bar{
  display:flex;gap:6px;margin-bottom:16px;overflow-x:auto;
  padding-bottom:4px;scrollbar-width:none;
}
.filter-bar::-webkit-scrollbar{display:none;}
.filter-btn{
  padding:6px 14px;border-radius:20px;white-space:nowrap;
  font:600 12px var(--font);cursor:pointer;border:none;
  background:var(--surface);color:var(--text3);
  border:1px solid var(--border);transition:all .2s;flex-shrink:0;
}
.filter-btn.active{
  background:rgba(108,99,255,0.12);
  border-color:rgba(108,99,255,0.3);color:var(--accent2);
}

/* ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ */
.section-label{
  font-size:11px;color:var(--text3);font-weight:600;
  letter-spacing:.8px;text-transform:uppercase;
  margin-bottom:10px;margin-top:8px;
}

/* ‚îÄ‚îÄ TRIP CARD ‚îÄ‚îÄ */
.trip-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;margin-bottom:10px;overflow:hidden;
  cursor:pointer;transition:all .2s;
}
.trip-card:hover{border-color:var(--border2);box-shadow:0 4px 16px rgba(0,0,0,.3);}
.trip-card.expanded .trip-body{display:block;}
.trip-header{
  padding:14px 16px;
  display:flex;align-items:center;gap:10px;
}
.trip-date-col{flex-shrink:0;}
.trip-day{
  width:42px;height:42px;border-radius:12px;
  background:var(--bg2);border:1px solid var(--border);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
}
.trip-day-num{font:700 16px var(--mono);line-height:1;}
.trip-day-name{font-size:8px;color:var(--text3);font-weight:600;letter-spacing:.3px;text-transform:uppercase;}
.trip-info{flex:1;min-width:0;}
.trip-driver{font-size:14px;font-weight:600;}
.trip-meta{font-size:12px;color:var(--text3);margin-top:2px;}
.trip-right{text-align:right;flex-shrink:0;}
.trip-time{font:600 13px var(--mono);color:var(--accent2);}
.trip-stops-count{
  font-size:11px;color:var(--text3);margin-top:2px;
}
.trip-badge{
  display:inline-block;padding:2px 7px;border-radius:4px;
  font-size:10px;font-weight:600;
}
.trip-badge.on-time{background:rgba(16,217,126,0.12);color:var(--green);}
.trip-badge.late{background:rgba(255,77,109,0.12);color:var(--red);}
.trip-badge.early{background:rgba(61,158,255,0.12);color:var(--blue);}

.trip-body{
  display:none;
  border-top:1px solid var(--border);
  padding:14px 16px;
}
.trip-stops-list{
  display:flex;flex-direction:column;gap:6px;margin-bottom:12px;
}
.ts-item{
  display:flex;align-items:center;gap:8px;
  font-size:13px;
}
.ts-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--border2);flex-shrink:0;
}
.ts-dot.ok{background:var(--green);}
.ts-name{flex:1;color:var(--text2);}
.ts-time{font:500 12px var(--mono);color:var(--text3);}
.ts-delta{font:500 11px var(--mono);}
.ts-delta.pos{color:var(--red);}
.ts-delta.neg{color:var(--green);}

.trip-footer-row{
  display:flex;gap:8px;
}
.trip-action-btn{
  flex:1;padding:8px;border-radius:10px;
  font:600 12px var(--font);cursor:pointer;border:none;
  background:var(--bg2);color:var(--text3);
  border:1px solid var(--border);transition:all .2s;
  display:flex;align-items:center;justify-content:center;gap:5px;
}
.trip-action-btn:hover{background:var(--surface2);color:var(--text);}
.trip-action-btn.danger:hover{background:rgba(255,77,109,0.1);color:var(--red);border-color:rgba(255,77,109,0.2);}

/* ‚îÄ‚îÄ MINI CHART ‚îÄ‚îÄ */
.chart-section{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:16px;margin-bottom:20px;
}
.chart-title{font-size:13px;font-weight:600;margin-bottom:14px;}
.chart-bars{
  display:flex;align-items:flex-end;gap:4px;height:60px;
  margin-bottom:8px;
}
.chart-bar-wrap{
  flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;
}
.chart-bar{
  width:100%;border-radius:4px 4px 0 0;
  background:var(--accent);opacity:.6;
  transition:height .5s ease, opacity .2s;min-height:2px;
}
.chart-bar:hover{opacity:1;}
.chart-bar.today{background:var(--green);opacity:1;}
.chart-bar-label{font-size:9px;color:var(--text3);font-weight:500;}

/* ‚îÄ‚îÄ PERSON STATS ‚îÄ‚îÄ */
.person-stats{
  display:flex;flex-direction:column;gap:8px;
}
.person-stat{
  display:flex;align-items:center;gap:10px;
  padding:10px 14px;
  background:var(--bg2);border:1px solid var(--border);
  border-radius:12px;
}
.person-avatar{
  width:32px;height:32px;border-radius:10px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;
  font:700 13px var(--font);color:#fff;flex-shrink:0;
}
.person-name{flex:1;font-size:13px;font-weight:600;}
.person-bar-wrap{flex:2;}
.person-bar-bg{
  height:4px;background:var(--border);border-radius:2px;overflow:hidden;
}
.person-bar-fill{height:100%;border-radius:2px;background:var(--accent);transition:width .5s ease;}
.person-stat.late-top .person-bar-fill{background:var(--red);}
.person-trips{font-size:11px;color:var(--text3);white-space:nowrap;}

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty-history{
  text-align:center;padding:48px 20px;
}
.empty-history .big{font-size:40px;margin-bottom:12px;}
.empty-history h3{font-size:18px;font-weight:700;margin-bottom:6px;}
.empty-history p{font-size:13px;color:var(--text3);line-height:1.6;}
.empty-history a{
  display:inline-block;margin-top:16px;
  padding:10px 20px;background:var(--accent);color:#fff;
  border-radius:10px;font:600 13px var(--font);text-decoration:none;
}
</style>
</head>
<body>

<header class="topbar">
  <a class="back-btn" href="index.html">‚Üê</a>
  <div class="topbar-title">Verlauf</div>
  <div class="topbar-sub" id="tripCount">‚Äî</div>
</header>

<main>
  <!-- Stats grid -->
  <div class="stats-grid">
    <div class="stat-card green">
      <div class="stat-icon">üöó</div>
      <div class="stat-val" id="statTrips">0</div>
      <div class="stat-label">Fahrten gesamt</div>
    </div>
    <div class="stat-card purple">
      <div class="stat-icon">üë•</div>
      <div class="stat-val" id="statPeople">0</div>
      <div class="stat-label">√ò Mitfahrer</div>
    </div>
    <div class="stat-card blue">
      <div class="stat-icon">‚è±</div>
      <div class="stat-val" id="statOnTime">‚Äî</div>
      <div class="stat-label">P√ºnktlichkeit</div>
    </div>
    <div class="stat-card orange">
      <div class="stat-icon">üìÖ</div>
      <div class="stat-val" id="statStreak">0</div>
      <div class="stat-label">Wochen in Folge</div>
    </div>
  </div>

  <!-- weekly chart -->
  <div class="chart-section">
    <div class="chart-title">Fahrten pro Wochentag</div>
    <div class="chart-bars" id="chartBars"></div>
  </div>

  <!-- filter -->
  <div class="filter-bar">
    <button class="filter-btn active" data-f="all">Alle</button>
    <button class="filter-btn" data-f="week">Diese Woche</button>
    <button class="filter-btn" data-f="month">Diesen Monat</button>
    <button class="filter-btn" data-f="ontime">P√ºnktlich</button>
    <button class="filter-btn" data-f="late">Versp√§tet</button>
  </div>

  <!-- person stats -->
  <div class="section-label">H√§ufigste Mitfahrer</div>
  <div class="person-stats" id="personStats"></div>

  <div class="section-label" style="margin-top:20px;">Fahrtenprotokoll</div>
  <div id="tripList"></div>
</main>

<script>
const DAYS = ['So','Mo','Di','Mi','Do','Fr','Sa'];
const MONTHS = ['Jan','Feb','M√§r','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'];

// ‚îÄ‚îÄ LOAD DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadHistory() {
  const raw = localStorage.getItem('rs_history');
  if (!raw) return generateDemo();
  try { return JSON.parse(raw); } catch { return generateDemo(); }
}

function generateDemo() {
  const now = new Date();
  const trips = [];
  for (let i = 0; i < 18; i++) {
    const d = new Date(now);
    d.setDate(d.getDate() - i * 1.3 - Math.random());
    // skip weekends
    if (d.getDay() === 0 || d.getDay() === 6) continue;
    const participants = ['Vasyl','Alex','Dima','Anatolii','Marvin','Ren√©']
      .sort(()=>Math.random()-.5).slice(0, 2 + Math.floor(Math.random()*3));
    const late = Math.random() < 0.15;
    const early = !late && Math.random() < 0.1;
    trips.push({
      id: `t${i}`,
      date: d.toISOString(),
      driver: 'Sergii',
      participants,
      arrivalTime: `07:${String(Math.floor(Math.random()*10)+0).padStart(2,'0')}`,
      actualArrival: late ? `07:${String(Math.floor(Math.random()*8)+5).padStart(2,'0')}` : null,
      status: late ? 'late' : early ? 'early' : 'on-time',
      stops: participants.map((n,j) => ({
        name: n,
        planned: new Date(d.getTime() - (participants.length - j) * 8 * 60000).toISOString(),
        actual: null
      }))
    });
  }
  return trips;
}

// ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcStats(trips) {
  const total = trips.length;
  const avgP = total ? (trips.reduce((s,t)=>s+t.participants.length,0)/total).toFixed(1) : 0;
  const onTime = total ? Math.round(trips.filter(t=>t.status==='on-time').length/total*100) : 0;
  let streak = 0;
  const now = new Date();
  for (let w = 0; w < 52; w++) {
    const weekStart = new Date(now); weekStart.setDate(now.getDate() - w*7 - now.getDay());
    const weekEnd = new Date(weekStart); weekEnd.setDate(weekStart.getDate() + 5);
    const hasTrip = trips.some(t => { const d=new Date(t.date); return d>=weekStart && d<=weekEnd; });
    if (hasTrip) streak++; else if (w>0) break;
  }
  return { total, avgP, onTime, streak };
}

function calcPersonStats(trips) {
  const counts = {};
  const lates = {};
  trips.forEach(t => {
    t.participants.forEach(p => {
      counts[p] = (counts[p]||0)+1;
      if (t.status==='late') lates[p] = (lates[p]||0)+1;
    });
  });
  return Object.entries(counts)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,5)
    .map(([name,count]) => ({ name, count, lates: lates[name]||0 }));
}

function calcDayChart(trips) {
  const counts = [0,0,0,0,0,0,0];
  trips.forEach(t => { const d=new Date(t.date); counts[d.getDay()]++; });
  return counts;
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let allTrips = [];
let activeFilter = 'all';

function filterTrips(filter) {
  const now = new Date();
  return allTrips.filter(t => {
    const d = new Date(t.date);
    if (filter === 'week') { const s=new Date(now); s.setDate(now.getDate()-now.getDay()); return d>=s; }
    if (filter === 'month') { return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear(); }
    if (filter === 'ontime') return t.status==='on-time';
    if (filter === 'late') return t.status==='late';
    return true;
  });
}

function renderStats(trips) {
  const s = calcStats(trips);
  document.getElementById('statTrips').textContent = s.total;
  document.getElementById('statPeople').textContent = s.avgP;
  document.getElementById('statOnTime').textContent = s.total ? `${s.onTime}%` : '‚Äî';
  document.getElementById('statStreak').textContent = s.streak;
  document.getElementById('tripCount').textContent = `${s.total} Fahrten`;
}

function renderChart(trips) {
  const counts = calcDayChart(trips);
  const max = Math.max(...counts, 1);
  const today = new Date().getDay();
  const container = document.getElementById('chartBars');
  container.innerHTML = '';
  DAYS.forEach((label, i) => {
    const pct = Math.round(counts[i]/max*100);
    const isToday = i === today;
    const wrap = document.createElement('div');
    wrap.className = 'chart-bar-wrap';
    wrap.innerHTML = `
      <div class="chart-bar ${isToday?'today':''}" style="height:${Math.max(pct,4)}%;"></div>
      <div class="chart-bar-label">${label}</div>`;
    container.appendChild(wrap);
  });
}

function renderPersonStats(trips) {
  const persons = calcPersonStats(trips);
  const maxCount = persons[0]?.count || 1;
  const container = document.getElementById('personStats');
  container.innerHTML = '';
  persons.forEach((p, i) => {
    const div = document.createElement('div');
    div.className = 'person-stat' + (i===0 && p.lates > p.count*0.3 ? ' late-top' : '');
    div.innerHTML = `
      <div class="person-avatar">${p.name.charAt(0)}</div>
      <div class="person-name">${p.name}</div>
      <div class="person-bar-wrap">
        <div class="person-bar-bg">
          <div class="person-bar-fill" style="width:${Math.round(p.count/maxCount*100)}%"></div>
        </div>
      </div>
      <div class="person-trips">${p.count}√ó</div>
    `;
    container.appendChild(div);
  });
}

function renderTrips(trips) {
  const container = document.getElementById('tripList');

  if (!trips.length) {
    container.innerHTML = `<div class="empty-history">
      <div class="big">üì≠</div>
      <h3>Keine Fahrten gefunden</h3>
      <p>Fahrten werden automatisch gespeichert,<br>wenn du den Live-Modus startest.</p>
      <a href="index.html">Zur Hauptseite</a>
    </div>`;
    return;
  }

  // group by week
  const groups = {};
  trips.forEach(t => {
    const d = new Date(t.date);
    const weekKey = getWeekLabel(d);
    if (!groups[weekKey]) groups[weekKey] = [];
    groups[weekKey].push(t);
  });

  container.innerHTML = '';
  Object.entries(groups).forEach(([week, wTrips]) => {
    const label = document.createElement('div');
    label.className = 'section-label'; label.textContent = week;
    container.appendChild(label);

    wTrips.forEach(trip => {
      const d = new Date(trip.date);
      const card = document.createElement('div');
      card.className = 'trip-card';

      const statusBadge = {
        'on-time': '<span class="trip-badge on-time">p√ºnktlich</span>',
        'late':    '<span class="trip-badge late">versp√§tet</span>',
        'early':   '<span class="trip-badge early">zu fr√ºh</span>',
      }[trip.status] || '';

      const stopsHTML = trip.stops.map(s => {
        const pt = new Date(s.planned);
        return `<div class="ts-item">
          <div class="ts-dot ok"></div>
          <div class="ts-name">${s.name}</div>
          <div class="ts-time">${fmtT(pt)}</div>
        </div>`;
      }).join('');

      card.innerHTML = `
        <div class="trip-header">
          <div class="trip-date-col">
            <div class="trip-day">
              <div class="trip-day-num">${d.getDate()}</div>
              <div class="trip-day-name">${DAYS[d.getDay()]}</div>
            </div>
          </div>
          <div class="trip-info">
            <div class="trip-driver">${trip.driver}</div>
            <div class="trip-meta">${trip.participants.join(', ')}</div>
          </div>
          <div class="trip-right">
            <div class="trip-time">${trip.arrivalTime}</div>
            <div class="trip-stops-count">${trip.participants.length} Stopps</div>
            <div style="margin-top:4px">${statusBadge}</div>
          </div>
        </div>
        <div class="trip-body">
          <div class="trips-stops-list" style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
            ${stopsHTML}
          </div>
          <div class="trip-footer-row">
            <button class="trip-action-btn" onclick="repeatTrip('${trip.id}')">üîÑ Wiederholen</button>
            <button class="trip-action-btn danger" onclick="deleteTrip('${trip.id}')">üóë L√∂schen</button>
          </div>
        </div>`;

      card.querySelector('.trip-header').addEventListener('click', () => {
        card.classList.toggle('expanded');
      });
      container.appendChild(card);
    });
  });
}

function fmtT(date) {
  return String(date.getHours()).padStart(2,'0') + ':' + String(date.getMinutes()).padStart(2,'0');
}

function getWeekLabel(date) {
  const now = new Date();
  const diffDays = Math.floor((now - date) / 86400000);
  if (diffDays < 7) return 'Diese Woche';
  if (diffDays < 14) return 'Letzte Woche';
  return `${MONTHS[date.getMonth()]} ${date.getFullYear()}`;
}

function repeatTrip(id) {
  const trip = allTrips.find(t=>t.id===id);
  if (!trip) return;
  // store as "pending load" for index.html
  localStorage.setItem('rs_repeatTrip', JSON.stringify(trip));
  window.location.href = 'index.html';
}

function deleteTrip(id) {
  allTrips = allTrips.filter(t=>t.id!==id);
  localStorage.setItem('rs_history', JSON.stringify(allTrips));
  renderAll();
}

function renderAll() {
  const filtered = filterTrips(activeFilter);
  renderStats(filtered);
  renderChart(filtered);
  renderPersonStats(filtered);
  renderTrips(filtered);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
allTrips = loadHistory();

// filter buttons
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.dataset.f;
    const filtered = filterTrips(activeFilter);
    renderTrips(filtered);
    renderStats(filtered);
  });
});

renderAll();

// animate bars after paint
setTimeout(() => {
  document.querySelectorAll('.chart-bar').forEach(b => {
    b.style.transition = 'height .6s cubic-bezier(.34,1.3,.64,1), opacity .2s';
  });
}, 100);
</script>
</body>
</html>
